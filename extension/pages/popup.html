<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>TransKit</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Chrome extension for instant AI-powered translation on input fields."
    />
    <link rel="stylesheet" href="/assets/styles/popup.css" />
  </head>

  <body class="bt-vars-container">
    <div class="bt-wrap">
      <div class="bt-header">
        <div class="bt-title-row">
          <h1 class="title">
            <img src="/assets/icons/icon-19.png" alt="TransKit" />
            <span data-i18n="popup.title">TransKit</span>
          </h1>
          <div class="bt-controls">
            <div id="lang-toggle" class="bt-lang-toggle">
              <span data-lang="en" class="active">EN</span>
              <span class="divider">|</span>
              <span data-lang="vi">VN</span>
            </div>
            <label class="bt-switch">
              <input type="checkbox" id="enabled" />
              <span class="slider round"></span>
            </label>
          </div>
        </div>
        <p data-i18n="popup.subtitle">Instant AI-powered translation.</p>
      </div>

      <!-- Tabs Navigation -->
      <div class="bt-tabs">
        <div class="bt-tab active" data-tab="general" data-i18n="popup.tabGeneral">General</div>
        <div class="bt-tab" data-tab="instant" data-i18n="popup.tabInstant">Instant</div>
        <div class="bt-tab" data-tab="ai-provider" data-i18n="popup.tabAIProvider">AI Provider</div>
        <div class="bt-tab" data-tab="help" data-i18n="popup.tabHelp">Help</div>
      </div>

      <div id="settings-container" class="bt-settings-container">
        <!-- General Tab Content -->
        <div id="tab-general" class="bt-tab-content active">
          <div class="bt-row">
            <div class="bt-field">
              <label for="native" data-i18n="popup.nativeLanguage">Native Language</label>
              <select id="native" class="bt-input"></select>
            </div>

            <div class="bt-field">
              <label for="target" data-i18n="popup.defaultTarget">Default Target</label>
              <select id="target" class="bt-input"></select>
            </div>
          </div>

          <div class="bt-field">
            <label for="timeout" data-i18n="popup.revertTimeout">Revert Timeout (seconds)</label>
            <input type="number" id="timeout" class="bt-input" min="1" max="60" />
          </div>

          <div class="bt-field-row">
            <input type="checkbox" id="prefer-native" />
            <label for="prefer-native" data-i18n="popup.preferNative">Prefer Native as Source</label>
          </div>

          <div class="bt-field-row">
            <input type="checkbox" id="confirm-modal" />
            <label for="confirm-modal" data-i18n="popup.showConfirmModal">Show Confirm Modal</label>
          </div>

          <div class="bt-divider"></div>

          <div class="bt-field">
            <label data-i18n="popup.aliases">Aliases</label>
            <div class="bt-alias-input-group">
              <input type="text" id="alias-key" placeholder="Key (e.g. e)" data-i18n-placeholder="popup.aliasKeyPlaceholder" />
              <input type="text" id="alias-value" placeholder="Code (e.g. en)" data-i18n-placeholder="popup.aliasValuePlaceholder" />
              <button id="add-alias" class="bt-button-small">+</button>
            </div>
            <div id="alias-list" class="bt-alias-list"></div>
          </div>
        </div>

        <!-- Instant Tab Content -->
        <div id="tab-instant" class="bt-tab-content">
          <div class="bt-field-row">
            <input type="checkbox" id="instant-translate-enabled" />
            <label for="instant-translate-enabled" data-i18n="popup.enableInstant">Enable Instant Translate for specific domains</label>
          </div>

          <div id="instant-settings" class="bt-instant-settings" hidden>
            <div class="bt-field">
              <label for="instant-delay" data-i18n="popup.instantDelay">Delay (seconds)</label>
              <input type="number" id="instant-delay" class="bt-input" min="1" max="10" value="3" />
            </div>

            <div class="bt-field">
              <label data-i18n="popup.toggleShortcut">Toggle Instant Shortcut</label>
              <div class="bt-shortcut-config">
                <div class="bt-shortcut-row">
                  <label>
                    <input type="checkbox" id="shortcut-ctrl" checked />
                    <span data-i18n="popup.shortcutCtrl">Ctrl/Cmd</span>
                  </label>
                  <label>
                    <input type="checkbox" id="shortcut-shift" checked />
                    <span data-i18n="popup.shortcutShift">Shift</span>
                  </label>
                  <label>
                    <input type="checkbox" id="shortcut-alt" />
                    <span data-i18n="popup.shortcutAlt">Alt</span>
                  </label>
                </div>
                <div class="bt-field">
                  <label for="shortcut-key" data-i18n="popup.shortcutKey">Key</label>
                  <input type="text" id="shortcut-key" class="bt-input" maxlength="1" value="I" style="width: 60px; text-transform: uppercase;" />
                </div>
                <div class="bt-shortcut-preview">
                  <small id="shortcut-preview" style="color: #888;">Ctrl+Shift+I (Cmd+Shift+I on Mac)</small>
                </div>
              </div>
            </div>

            <div class="bt-field">
              <label data-i18n="popup.activeDomains">Active Domains</label>
              <div id="instant-domain-list" class="bt-domain-list"></div>
              <div class="bt-domain-input-group">
                <input type="text" id="new-domain" placeholder="example.com" data-i18n-placeholder="popup.domainPlaceholder" />
                <button id="add-domain" class="bt-button-small">+</button>
              </div>
            </div>
          </div>
        </div>

        <!-- AI Provider Tab Content -->
        <div id="tab-ai-provider" class="bt-tab-content">
          <div class="bt-provider-list-container">
            <div id="provider-list" class="bt-provider-list">
              <!-- Provider items will be injected here -->
            </div>
            <button id="btn-add-provider" class="bt-button bt-button-outline" data-i18n="popup.addProvider">+ Add Provider</button>
          </div>

          <!-- Add/Edit Provider Form (Hidden by default) -->
          <div id="provider-form" class="bt-provider-form" hidden>
            <h3 id="form-title" class="bt-form-title">Add Provider</h3>
            
            <div class="bt-field">
              <label data-i18n="popup.providerType">Provider Type</label>
              <select id="form-type" class="bt-input">
                <option value="gemini">Google Gemini</option>
                <option value="openai">OpenAI (GPT)</option>
                <option value="openrouter">OpenRouter</option>
                <option value="deepl">DeepL</option>
                <option value="groq">Groq (Fast)</option>
                <option value="ollama">Ollama (Local)</option>
                <option value="custom">Custom Endpoint</option>
              </select>
            </div>

            <div class="bt-field">
              <label data-i18n="popup.providerName">Name</label>
              <input type="text" id="form-name" class="bt-input" placeholder="e.g. My Gemini" />
            </div>

            <!-- Dynamic Fields Container -->
            <div id="form-dynamic-fields"></div>

            <div class="bt-actions bt-row">
              <button id="form-cancel" class="bt-button bt-button-outline" data-i18n="dialog.cancel">Cancel</button>
              <button id="form-save" class="bt-button" data-i18n="popup.save">Save</button>
            </div>
          </div>

          <!-- Prompt Customization Section -->
          <div id="prompt-customization" class="bt-prompt-section">
            <h3 class="bt-section-title" data-i18n="popup.promptCustomization">Prompt Customization</h3>
            <p class="bt-help-text" data-i18n="popup.promptHelp">Customize the translation prompts to fit your specific needs (e.g., technical, casual, medical)</p>
            
            <div class="bt-field">
              <label for="system-prompt-display" data-i18n="popup.systemPrompt">System Prompt (Read-only)</label>
              <textarea id="system-prompt-display" class="bt-input bt-readonly-textarea" readonly rows="3"></textarea>
            </div>

            <div class="bt-field">
              <label for="user-custom-prompt" data-i18n="popup.userPrompt">Your Custom Context (Optional)</label>
              <textarea id="user-custom-prompt" class="bt-input" maxlength="500" rows="4" placeholder="" data-i18n-placeholder="popup.promptPlaceholder"></textarea>
              <small class="bt-char-counter"><span id="prompt-char-count">0</span>/500</small>
            </div>
          </div>
        </div>

        <!-- Help Tab Content -->
        <div id="tab-help" class="bt-tab-content">
          <div class="bt-help-section">
            <h3 data-i18n="help.title">How to use TransKit</h3>
            
            <div class="bt-help-item">
              <h4 data-i18n="help.commands.title">Command Translation</h4>
              <p data-i18n="help.commands.desc">Type your text followed by a command to translate instantly.</p>
              <p class="bt-code-example" data-i18n="help.commands.example">Example: <code>Hello !!vi</code> → <code>Xin chào</code></p>
              <p data-i18n="help.commands.default">Use <code>!!t</code> for your default target language.</p>
            </div>

            <div class="bt-help-item">
              <h4 data-i18n="help.selection.title">Select to Translate</h4>
              <p data-i18n="help.selection.desc">Highlight any text on a page and click the TransKit icon that appears.</p>
            </div>

            <div class="bt-help-item">
              <h4 data-i18n="help.instant.title">Instant Mode</h4>
              <p data-i18n="help.instant.desc">On enabled domains, just type and wait. A suggestion will appear.</p>
              <p data-i18n="help.instant.apply">Press <kbd>Tab</kbd> to apply or <kbd>Esc</kbd> to dismiss.</p>
            </div>

            <div class="bt-divider"></div>
            
            <p class="bt-ai-warning">
              <em data-i18n="popup.aiWarning">
                Requires Chrome desktop with AI APIs enabled; the model will download
                on first use if needed.
              </em>
            </p>
          </div>
        </div>

        <div class="bt-actions">
          <button id="save" class="bt-button" data-i18n="popup.savePreferences">Save preferences</button>
        </div>
      </div>
    </div>

    <script type="module" src="/src/popup.js"></script>
  </body>
</html>
